<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: https://ssl.gstatic.com 'unsafe-eval' https: http:; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content: https: http:; connect-src 'self' https: http:">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover, user-scalable=no">
    <meta name="color-scheme" content="light dark">
    <title>Fema - Period Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Hamburger Menu Icon -->
    <div class="hamburger-menu" id="hamburgerMenu">
        <div class="hamburger-bar"></div>
        <div class="hamburger-bar"></div>
        <div class="hamburger-bar"></div>
    </div>
    
    <!-- Mobile Navigation Menu -->
    <div class="nav-menu-mobile" id="mobileMenu">
        <span class="close-menu" id="closeMenu">&times;</span>
        <span class="nav-item active" id="calendarBtnMobile">CALENDAR</span>
        <span class="nav-item" id="articlesBtnMobile">ARTICLES</span>
        <span class="nav-item" id="productsBtnMobile">PRODUCTS</span>
        <span class="nav-item" id="logoutBtnMobile">LOGOUT</span>
        <span class="nav-item" id="deleteDataBtnMobile">DELETE ALL DATA</span>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="login-frame">
            <div class="login-header">
                <div class="logo-brand">
                    <img src="fema-logo.png" alt="FEMA Logo" class="logo-image">
                    <p class="tagline">secure period tracking | always under your control</p>
                </div>
            </div>
            
            <div class="login-card">
                <form class="login-form" id="loginForm">
                    <div class="form-field">
                        <input type="text" id="username" class="field-input" placeholder="User Name" required>
                    </div>
                    <div class="form-field">
                        <input type="password" id="password" class="field-input" placeholder="Password" required>
                    </div>
                    <button type="submit" class="login-btn">Login / Register</button>
                </form>
                
                <!-- Delete All Data Link -->
                <div class="delete-data-link">
                    <span class="delete-link-text" id="loginDeleteAllData">Delete All Data</span>
                </div>
            </div>
            
            <div class="login-description">
                <p>Only a single user account is supported. Your password is never stored; if you forget it, your data cannot be recovered, as there is no password reset option.</p>
            </div>
        </div>
    </div>

    <!-- Calendar Screen -->
    <div id="calendarScreen" class="screen">
        <header class="main-header">
            <div class="header-content">
                <div class="logo">
                    <img src="fema-logo.png" alt="FEMA Logo">
                </div>
                <nav class="nav-menu">
                    <span class="nav-item active" id="calendarBtn">CALENDAR</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="articlesBtn">ARTICLES</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="productsBtn">PRODUCTS</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="logoutBtn">LOGOUT</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="deleteDataBtn">DELETE ALL DATA</span>
                </nav>
            </div>
        </header>

        <!-- Main Calendar Container -->
        <div class="calendar-container">
            <!-- Calendar Layout Frame -->
            <div class="calendar-layout-frame">
                <!-- Three Calendar Layout -->
                <div class="calendar-layout">
                    <!-- Previous Month (Side Calendar) -->
                    <div class="side-calendar prev-calendar">
                        <div class="side-month-header" id="prevMonthHeader">JULY</div>
                        <div class="mini-calendar" id="prevCalendar">
                            <!-- Mini calendar will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Main Calendar Container with Month Navigation -->
                    <div class="main-calendar-container">
                        <!-- Year Above Month -->
                        <div class="month-year" id="calendarYearDisplay">2024</div>
                        <!-- Month Navigation Box -->
                        <div class="month-navigation-box">
                            <button class="month-nav-btn" id="prevMonthBtn">‚Äπ</button>
                            <div class="month-display-box">
                                <span class="month-text" id="monthDisplay">AUGUST</span>
                            </div>
                            <button class="month-nav-btn" id="nextMonthBtn">‚Ä∫</button>
                        </div>
                        
                        <!-- Main Calendar -->
                        <div class="main-calendar-wrapper">
                            <!-- Left Arrow -->
                            <button class="month-nav-arrow left-arrow" id="prevMonth">‚Äπ</button>
                            
                            <div class="month-august" id="mainCalendar">
                                <div class="overlap-group">
                                    <!-- Week Headers -->
                                    <div class="week-headers" id="weekHeaders">
                                        <div class="week-header week-col">Week</div>
                                        <div class="week-header">Mo</div>
                                        <div class="week-header">Tu</div>
                                        <div class="week-header">We</div>
                                        <div class="week-header">Th</div>
                                        <div class="week-header">Fr</div>
                                        <div class="week-header weekend">Sa</div>
                                        <div class="week-header weekend">Su</div>
                                    </div>
                                    <!-- Calendar Grid -->
                                    <div class="calendar-grid" id="calendarGrid">
                                        <!-- Calendar days will be generated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Arrow -->
                            <button class="month-nav-arrow right-arrow" id="nextMonth">‚Ä∫</button>
                        </div>
                    </div>

                    <!-- Next Month (Side Calendar) -->
                    <div class="side-calendar next-calendar">
                        <div class="side-month-header" id="nextMonthHeader">SEPTEMBER</div>
                        <div class="mini-calendar" id="nextCalendar">
                            <!-- Mini calendar will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Color Codes Legend -->
        <div class="color-codes-legend">
            <div class="legend-item period-day"><span class="legend-color"></span>Period</div>
            <div class="legend-item fertility-day"><span class="legend-color"></span>Fertility Window</div>
            <div class="legend-item ovulation-day"><span class="legend-color"></span>Ovulation</div>
            <div class="legend-item predicted-range"><span class="legend-color"></span>Predicted Period Start</div>
            <div class="legend-item pregnancy-day"><span class="legend-color"></span>Pregnancy</div>
            <div class="legend-item birth-day"><span class="legend-color"></span>Birth</div>
        </div>
    </div>

    <!-- Year View Screen -->
    <div id="yearScreen" class="screen">
        <header class="main-header">
            <div class="header-content">
                <div class="logo">
                    <img src="fema-logo.png" alt="FEMA Logo">
                </div>
                <nav class="nav-menu">
                    <span class="nav-item" id="calendarBtnYear">CALENDAR</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="articlesBtnYear">ARTICLES</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="productsBtnYear">PRODUCTS</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="logoutBtnYear">LOGOUT</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="deleteDataBtnYear">DELETE ALL DATA</span>
                </nav>
            </div>
        </header>

        <div class="year-view-container">
            <div class="year-view-header">
                <button class="year-nav-btn" id="prevYear">‚Äπ</button>
                <h2 id="yearDisplay">2024</h2>
                <button class="year-nav-btn" id="nextYear">‚Ä∫</button>
            </div>
            <button class="action-btn primary year-export" id="exportDataBtn">Export Data</button>
            <div class="year-grid" id="yearGrid">
                <!-- 12 months will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Articles Screen -->
    <div id="articlesScreen" class="screen">
        <header class="main-header">
            <div class="header-content">
                <div class="logo">
                    <img src="fema-logo.png" alt="FEMA Logo">
                </div>
                <nav class="nav-menu">
                    <span class="nav-item" id="calendarBtnArticles">CALENDAR</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item active" id="articlesBtnArticles">ARTICLES</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="productsBtnArticles">PRODUCTS</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="logoutBtnArticles">LOGOUT</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="deleteDataBtnArticles">DELETE ALL DATA</span>
                </nav>
            </div>
        </header>

        <div class="articles-container">
            <div class="articles-header">
                <h2>Health & Wellness Articles</h2>
                <p>Educational content and product selection to support your well‚Äëbeing</p>
            </div>
            <div class="loading-indicator" id="articlesLoading" style="text-align: center; padding: 20px; display: none;">
                <p>Loading...</p>
            </div>
            <div class="articles-grid" id="articlesGrid">
                <!-- Articles will be generated by JavaScript -->
            </div>
            <div class="article-content" id="articleContent" style="display: none;">
                <!-- Article content will be displayed here -->
            </div>
            <div class="articles-actions">
                <button class="action-btn secondary" id="backToArticles" style="display: none;">‚Üê Back to Articles</button>
            </div>
        </div>
    </div>

    <!-- Products Screen -->
    <div id="productsScreen" class="screen">
        <header class="main-header">
            <div class="header-content">
                <div class="logo">
                    <img src="fema-logo.png" alt="FEMA Logo">
                </div>
                <nav class="nav-menu">
                    <span class="nav-item" id="calendarBtnProducts">CALENDAR</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="articlesBtnProducts">ARTICLES</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item active" id="productsBtnProducts">PRODUCTS</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="logoutBtnProducts">LOGOUT</span>
                    <span class="nav-separator">|</span>
                    <span class="nav-item" id="deleteDataBtnProducts">DELETE ALL DATA</span>
                </nav>
            </div>
        </header>

        <div class="articles-container">
            <div class="articles-header">
                <h2>Recommended Products</h2>
                <p>Curated selection of products to support your well‚Äëbeing</p>
            </div>
            <div class="loading-indicator" id="productsLoading" style="text-align: center; padding: 20px; display: none;">
                <p>Loading...</p>
            </div>
            <div class="articles-grid" id="productsGrid">
                <!-- Products will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Action Popup Modal -->
    <div class="modal-overlay" id="actionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Select Action</h3>
                <button class="close-btn" id="closeModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="action-buttons" id="actionButtons">
                    <!-- Dynamic action buttons will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Period Edit Modal -->
    <div class="modal-overlay" id="periodModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Period</h3>
                <button class="close-btn" id="closePeriodModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="period-form">
                    <div class="date-selectors" style="display:none;">
                        <select id="periodDay"></select>
                        <select id="periodMonth"></select>
                        <select id="periodYear"></select>
                    </div>
                    <div id="flowControl">
                        <label>Flow Intensity:</label>
                        <div class="flow-intensity">
                            <input type="range" id="flowRange" min="1" max="5" value="3">
                            <div class="flow-labels">
                                <span>Light</span>
                                <span>Normal</span>
                                <span>Heavy</span>
                            </div>
                        </div>
                    </div>
                    <div id="lengthControl">
                        <label>Period Length (days):</label>
                        <input type="number" id="periodLength" min="1" max="10" value="5">
                    </div>
                    <div class="modal-actions">
                        <button class="action-btn primary" id="savePeriod">Save</button>
                        <button class="action-btn secondary" id="deletePeriod">Delete</button>
                        <button class="action-btn secondary" id="cancelPeriodEdit">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div class="modal-overlay" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Note</h3>
                <button class="close-btn" id="closeNoteModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="note-form">
                    <label>Note for <span id="noteDate"></span>:</label>
                    <textarea id="noteText" placeholder="Enter your note here..." rows="5"></textarea>
                    <div class="modal-actions">
                        <button class="action-btn primary" id="saveNote">Save Note</button>
                        <button class="action-btn secondary" id="deleteNote">Delete Note</button>
                        <button class="action-btn secondary" id="cancelNote">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pregnancy Modal -->
    <div class="modal-overlay" id="pregnancyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pregnancyModalTitle">Set Pregnancy</h3>
                <button class="close-btn" id="closePregnancyModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="pregnancy-form">
                    <label id="pregnancyDateLabel">Pregnancy Start Date:</label>
                    <div class="date-selectors">
                        <select id="pregnancyDay"></select>
                        <select id="pregnancyMonth"></select>
                        <select id="pregnancyYear"></select>
                    </div>
                    <div class="pregnancy-reminder" id="pregnancyReminder" style="display: none;">
                        <h4>Current Month Reminder:</h4>
                        <p id="pregnancyReminderText"></p>
                    </div>
                    <div class="modal-actions">
                        <button class="action-btn primary" id="savePregnancy">Save</button>
                        <button class="action-btn secondary" id="cancelPregnancy">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mood & Health Modal -->
    <div class="modal-overlay" id="moodModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mood & Health Tracking</h3>
                <button class="close-btn" id="closeMoodModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="mood-form">
                    <label>Symptoms:</label>
                    <div class="symptom-checkboxes">
                        <label><input type="checkbox" name="symptoms" value="cramps"> Cramps</label>
                        <label><input type="checkbox" name="symptoms" value="headache"> Headache</label>
                        <label><input type="checkbox" name="symptoms" value="nausea"> Nausea</label>
                        <label><input type="checkbox" name="symptoms" value="bloating"> Bloating</label>
                        <label><input type="checkbox" name="symptoms" value="acne"> Acne</label>
                        <label><input type="checkbox" name="symptoms" value="backPain"> Back Pain</label>
                    </div>
                    <label>Mood:</label>
                    <select id="moodSelect">
                        <option value="happy">üòä Happy</option>
                        <option value="sad">üò¢ Sad</option>
                        <option value="angry">üò† Angry</option>
                        <option value="anxious">üò∞ Anxious</option>
                        <option value="tired">üò¥ Tired</option>
                        <option value="energetic">‚ö° Energetic</option>
                        <option value="okay" selected>üòê Okay</option>
                    </select>
                    <label>Sleep Quality:</label>
                    <select id="sleepSelect">
                        <option value="excellent">Excellent</option>
                        <option value="good" selected>Good</option>
                        <option value="fair">Fair</option>
                        <option value="poor">Poor</option>
                    </select>
                    <label>Weight (kg):</label>
                    <input type="number" id="weightInput" min="0" step="0.1" placeholder="e.g., 65.5">
                    <label>Body Temperature (¬∞C):</label>
                    <input type="number" id="tempInput" min="30" max="45" step="0.1" placeholder="e.g., 36.6">
                    <div class="modal-actions">
                        <button class="action-btn primary" id="saveMood">Save</button>
                        <button class="action-btn secondary" id="deleteMood">Delete</button>
                        <button class="action-btn secondary" id="cancelMood">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Medical Visit Modal -->
    <div class="modal-overlay" id="medicalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gynecologist Visit</h3>
                <button class="close-btn" id="closeMedicalModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="medical-form">
                    <label>Visit Type:</label>
                    <select id="visitType">
                        <option value="routine">Routine Checkup</option>
                        <option value="consultation">Consultation</option>
                        <option value="ultrasound">Ultrasound</option>
                        <option value="pap">Pap Smear</option>
                        <option value="sti">STI Screening</option>
                        <option value="prenatal">Prenatal Check</option>
                        <option value="postpartum">Postpartum Check</option>
                        <option value="mammogram">Mammogram Referral</option>
                        <option value="other">Other</option>
                    </select>
                    <label>Visit Time (optional):</label>
                    <div class="time-selector">
                        <div class="dial-control">
                            <label for="medicalHour">Hour</label>
                            <div class="dial-wrapper">
                                <input type="range" id="medicalHour" min="0" max="23" value="12" class="dial-input">
                                <span class="dial-value" id="medicalHourValue">12</span>
                            </div>
                        </div>
                        <div class="dial-control">
                            <label for="medicalMinute">Minute</label>
                            <div class="dial-wrapper">
                                <input type="range" id="medicalMinute" min="0" max="59" value="0" class="dial-input">
                                <span class="dial-value" id="medicalMinuteValue">00</span>
                            </div>
                        </div>
                    </div>
                    <label>Notes:</label>
                    <textarea id="medicalNotes" placeholder="Any notes about the visit..." rows="3"></textarea>
                    <div class="modal-actions">
                        <button class="action-btn primary" id="saveMedical">Save Visit</button>
                        <button class="action-btn secondary" id="deleteMedical">Delete Visit</button>
                        <button class="action-btn secondary" id="cancelMedical">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sexual Activity Modal -->
    <div class="modal-overlay" id="sexModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sexual Activity</h3>
                <button class="close-btn" id="closeSexModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="medical-form">
                    <label>Note (optional):</label>
                    <textarea id="sexNote" placeholder="Add a note..." rows="3"></textarea>
                    <div class="modal-actions">
                        <button class="action-btn primary" id="saveSex">Save</button>
                        <button class="action-btn secondary" id="deleteSex">Delete</button>
                        <button class="action-btn secondary" id="cancelSex">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Format Selection Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Data</h3>
                <button class="close-btn" id="closeExportModal">√ó</button>
            </div>
            <div class="modal-body">
                <p>Choose export format:</p>
                <div class="export-options">
                    <button class="export-option" id="exportJSON">
                        <div class="export-details">
                            <h4>JSON</h4>
                            <p>Complete data backup with all details</p>
                        </div>
                    </button>
                    <button class="export-option" id="exportXLSX">
                        <div class="export-details">
                            <h4>Excel (XLSX)</h4>
                            <p>Excel spreadsheet format</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirm Action</h3>
                <button class="close-btn" id="closeConfirmModal">√ó</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
                <div id="confirmInputWrap" style="display:none; margin-top:10px;">
                    <label for="confirmInput" style="display:block; margin-bottom:6px; color: var(--collection-1-juicy-peach);">Type 'delete' to confirm:</label>
                    <input type="text" id="confirmInput" placeholder="delete" />
                </div>
                <div class="modal-actions">
                    <button class="action-btn primary" id="confirmYes">Yes</button>
                    <button class="action-btn secondary" id="confirmNo">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip">
        <div class="tooltip-content" id="tooltipContent"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <p>Loading...</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="cordova.js"></script>
    <script src="crypto-js.min.js"></script>
    <script src="masonry.pkgd.min.js"></script>
    <script src="xlsx.full.min.js"></script>
    <script src="script.js"></script>
    <script>
        // Add hamburger menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing hamburger menu...');
            
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            const mobileMenu = document.getElementById('mobileMenu');
            const closeMenu = document.getElementById('closeMenu');
            
            console.log('Menu elements:', {hamburgerMenu, mobileMenu, closeMenu});
            
            // Open mobile menu
            if (hamburgerMenu && mobileMenu) {
                // Handle both click and touch events for better mobile support
                const openMenu = function() {
                    console.log('Hamburger menu clicked/touched');
                    mobileMenu.classList.add('active');
                };
                
                hamburgerMenu.addEventListener('click', openMenu);
                hamburgerMenu.addEventListener('touchstart', openMenu);
            } else {
                console.log('Hamburger menu or mobile menu element not found');
            }
            
            // Close mobile menu
            if (closeMenu && mobileMenu) {
                // Handle both click and touch events for better mobile support
                const closeMenuHandler = function() {
                    console.log('Close menu clicked/touched');
                    mobileMenu.classList.remove('active');
                };
                
                closeMenu.addEventListener('click', closeMenuHandler);
                closeMenu.addEventListener('touchstart', closeMenuHandler);
            } else {
                console.log('Close menu or mobile menu element not found');
            }
            
            // Close menu when clicking outside
            if (mobileMenu) {
                // Handle both click and touch events for better mobile support
                const closeOnOutsideClick = function(e) {
                    if (e.target === mobileMenu) {
                        console.log('Clicked/touched outside menu, closing');
                        mobileMenu.classList.remove('active');
                    }
                };
                
                mobileMenu.addEventListener('click', closeOnOutsideClick);
                mobileMenu.addEventListener('touchstart', closeOnOutsideClick);
            } else {
                console.log('Mobile menu element not found');
            }
            
            // Also close menu when window is resized to desktop size
            window.addEventListener('resize', function() {
                if (window.innerWidth > 650 && mobileMenu) {
                    mobileMenu.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>